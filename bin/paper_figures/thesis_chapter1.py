#! /usr/bin/env python
"""
thesis_chapter1.py
"""

import matplotlib.pyplot as plt
import numpy as np
from astropy.io import fits
from microlens.jlu.model import PSPL_Phot_Par_Param1
from zort.photometry import magnitudes_to_fluxes

from puzle.models import CandidateLevel4
from puzle.pspl_gp_fit import load_cand_fitter_data
from puzle.utils import return_figures_dir, return_data_dir


def plot_example_ulens():
    ra = 307.14937972
    dec = 22.830468200000002
    radius = 2.
    query = CandidateLevel4.query.filter(CandidateLevel4.cone_search(ra, dec, radius),
                                                 CandidateLevel4.level5 == True)
    cand = query.first()
    cand_fitter_data = load_cand_fitter_data(cand.id)
    tobs_r = cand_fitter_data['data']['t_phot1']
    mag_r = cand_fitter_data['data']['mag1']
    tobs_g = cand_fitter_data['data']['t_phot2']
    mag_g = cand_fitter_data['data']['mag2']

    flux_r, _ = magnitudes_to_fluxes(mag_r)
    flux_base_r = np.median(flux_r[tobs_r >= 58600])
    flux_g, _ = magnitudes_to_fluxes(mag_g)
    flux_base_g = np.median(flux_g[tobs_g >= 58600])

    source_id = '215341_49373'
    hmjd_model = np.linspace(58200, 59200, 10000)

    model_params_r = cand.pspl_gp_fit_dct[source_id]['r']
    model_r = PSPL_Phot_Par_Param1(**model_params_r)
    mag_model_r = model_r.get_photometry(hmjd_model)

    model_params_g = cand.pspl_gp_fit_dct[source_id]['g']
    model_g = PSPL_Phot_Par_Param1(**model_params_g)
    mag_model_g = model_g.get_photometry(hmjd_model)

    color_r_band = '#e93574'
    color_g_band = '#47aaae'

    fig, ax = plt.subplots(figsize=(12, 6))
    ax.clear()
    ax.set_title('ZTF18abnbmsr')
    ax.scatter(tobs_r, mag_r, color=color_r_band, label='r-band')
    ax.scatter(tobs_g, mag_g, color=color_g_band, label='g-band')
    ax.plot(hmjd_model, mag_model_r, color=color_r_band, alpha=.3)
    ax.plot(hmjd_model, mag_model_g, color=color_g_band, alpha=.3)
    # ax.scatter(tobs_r, flux_r / flux_base_r, color=color_r_band, label='r-band')
    # ax.scatter(tobs_g, flux_g / flux_base_g, color=color_g_band, label='g-band')
    ax.set_xlabel('Observation Time (heliocentric modified julian date)')
    ax.set_ylabel('Magnitude')
    ax.invert_yaxis()
    ax.set_xlim(58200, 59200)
    ax.legend()
    fig.tight_layout()

    fname = '%s/thesis_chapter1_example_ulens.png' % return_figures_dir()
    fig.savefig(fname, dpi=100, bbox_inches='tight', pad_inches=0.05)
    print('-- %s saved' % fname)
    plt.close(fig)


def download_example_fringez_image():
    from ztfquery import query
    from astropy import time
    import shutil
    import os

    jdstart = time.Time("2019-01-01").jd
    jdend = time.Time("2021-06-01").jd
    zquery = query.ZTFQuery()

    zquery.load_metadata(sql_query=f"field=861 and ccdid=1 and qid=1 and fid=1 and maglimit>21 and obsjd BETWEEN {jdstart} AND {jdend}")
    zquery.download_data()
    fis = zquery.download_data(nodl=True)[1]

    data_dir = return_data_dir()
    for fi in fis:
        fi_base = os.path.basename(fi)
        fi_new = f'{data_dir}/{fi_base}'
        shutil.move(fi, fi_new)

    zquery.load_metadata(sql_query=f"field=861 and ccdid=1 and qid=1 and fid=2 and maglimit>20.8 and obsjd BETWEEN {jdstart} AND {jdend}")
    zquery.download_data()
    fis = zquery.download_data(nodl=True)[1]

    data_dir = return_data_dir()
    for fi in fis:
        fi_base = os.path.basename(fi)
        fi_new = f'{data_dir}/{fi_base}'
        shutil.move(fi, fi_new)


def plot_example_fringez():
    data_dir = return_data_dir()
    fname_g = f'{data_dir}/ztf_20190402280903_000861_zg_c01_o_q1_sciimg.fits'
    with fits.open(fname_g) as f:
        data_g = f[0].data

    fname_r = f'{data_dir}/ztf_20200219346956_000861_zr_c01_o_q1_sciimg.fits'
    with fits.open(fname_r) as f:
        data_r = f[0].data

    fname_i = f'{data_dir}/ztf_20200116386192_000861_zi_c01_o_q1_sciimg.fits'
    with fits.open(fname_i) as f:
        data_i = f[0].data

    fig, ax = plt.subplots(1, 3, figsize=(12, 5))
    for a in ax:
        a.clear()
        a.axis('off')
    ax[0].set_title('g-band')
    ax[0].imshow(data_g, cmap='gray', origin='lower', vmin=60, vmax=150)
    ax[1].set_title('r-band')
    ax[1].imshow(data_r, cmap='gray', origin='lower', vmin=90, vmax=150)
    ax[2].set_title('i-band')
    ax[2].imshow(data_i, cmap='gray', origin='lower', vmin=515, vmax=650)
    fig.tight_layout()

    fname = '%s/thesis_chapter1_example_fringez.png' % return_figures_dir()
    fig.savefig(fname, dpi=100, bbox_inches='tight', pad_inches=0.05)
    print('-- %s saved' % fname)
    plt.close(fig)


def return_pbh_te_shift_data():
    no_pbh = np.array([
        [0.5219260413278013, 6.9737322033773985],
        [0.6001340052424385, 12.466557386634188],
        [0.7123101901797182, 18.008467018482364],
        [0.7901130246073789, 27.07328871378602],
        [0.8598848420907469, 40.86983565433865],
        [0.9358179382308637, 61.69710241231584],
        [1.0280775853796265, 96.26733862315086],
        [1.1083923264647386, 139.15361858078626],
        [1.206270154944395, 200.30136216451015],
        [1.3267513531210295, 295.0800845941071],
        [1.4627003279433577, 432.95049034082757],
        [1.6346107197178763, 652.8583076845283],
        [1.8222420349904138, 1001.3673497285432],
        [2.008962731338181, 1474.1098522341701],
        [2.2450750529169645, 2219.508807268856],
        [2.5027794592217734, 3386.9506513129227],
        [2.7820275244625394, 4989.590055232102],
        [3.0924327424653644, 7182.146572245001],
        [3.4740253838705764, 10418.356039721595],
        [3.8210079723306745, 15331.18872441288],
        [4.384281555083343, 22330.643982125002],
        [5.138149035368004, 32834.88360215188],
        [6.281892410264672, 48052.42468918793],
        [7.927859466201154, 63576.833539561325],
        [10.005099038808138, 73569.05216864937],
        [12.626612164749453, 73129.17728845657],
        [15.93500815340165, 67623.80088001968],
        [20.11026247863026, 57912.32909357974],
        [25.379507375593775, 45040.922109919724],
        [31.692372587139186, 32510.318537649746],
        [39.15907584815945, 23038.82569093712],
        [47.87582058641335, 16171.301866798212],
        [58.326878262297875, 10852.644627067622],
        [66.68957210635334, 8055.785475676764],
        [80.58188311334894, 6049.416713943807],
        [96.23046355044137, 4017.447061734287],
        [113.6552984741616, 2680.6334147787175],
        [132.54218779564877, 1797.7298479119459],
        [156.54213186281314, 1203.3950999448298],
        [217.2909553547836, 622.62731014838],
        [235.23166344870793, 399.83815837033063],
        [272.7785122332763, 273.2149204687809],
        [321.3774193573848, 183.95202068753326],
        [359.993953284575, 120.97697216039587],
        [401.3164150365714, 83.151907873623],
        [446.0933657324867, 57.959002878604934],
        [518.8629726118266, 36.56994512742798],
        [593.5545434904409, 23.665669419264084],
        [673.8872542242093, 15.92750474240298],
        [815.224372421772, 10.968908075828397],
        [1007.2907272927538, 8.098822944738174],
        [1244.6077958584683, 6.638252562487614],
        [1358.1009728989034, 4.510007561513414],
        [1528.989288531645, 2.894597709791051],
        [1621.360610812878, 1.991360676787644],
        [1660.0742505784046, 1.1523629172217846],
        [187.3817422860381, 789.2838228099614],
        [0.5590810182512221, 9.642501682565362]])

    pbh_frac_5 = np.array([
        [0.5120825479470089, 6.478401575941694],
        [0.6260712659820531, 13.801182780491185],
        [0.7337228302884758, 19.465777397911708],
        [0.8070064188447906, 30.087076348215877],
        [0.8782700264679212, 45.231840316723236],
        [0.9558266469505197, 66.52837135638528],
        [1.0304970519508727, 98.77022202193659],
        [1.132090845483578, 149.2979415488979],
        [1.2320613982850874, 219.39728672223978],
        [1.3551186030779963, 319.4875580255118],
        [1.5063162032848352, 480.1074653821279],
        [1.6606647502926137, 710.153309897173],
        [1.8558417953612683, 1061.5880584070092],
        [2.0688674612283573, 1634.6699233296397],
        [2.2997017177821646, 2456.4876281145207],
        [2.5562913477454936, 3667.1014047909493],
        [2.8497191969645894, 5475.981759428037],
        [3.2167915673758634, 8110.94058499546],
        [3.570895046972902, 11589.310805317953],
        [4.0285370675852255, 17710.681248251836],
        [4.6715579512624466, 26351.510811532924],
        [5.533040962650638, 38321.82073476713],
        [6.83662197052846, 54201.25253445793],
        [8.627937994819819, 67623.80088001968],
        [10.888610539438861, 73681.60264171608],
        [13.741619324427576, 71712.17752918752],
        [17.342166934295822, 64638.20999728681],
        [21.886121779138385, 53552.521118552046],
        [27.620673261079123, 40111.99686807842],
        [34.85777878301315, 27824.746032901734],
        [43.070249774114224, 19617.032041938935],
        [52.657615281654394, 13429.270204051698],
        [64.09301727363467, 8916.285163506436],
        [77.59138893333424, 6239.904303664862],
        [92.24376944735621, 4157.95979728082],
        [135.81318805926574, 2473.9800480688104],
        [191.38814839091685, 1252.1725934248634],
        [241.53523251375037, 809.797064179061],
        [289.11892378949574, 559.1011548313458],
        [342.435407008585, 387.50185599613457],
        [392.9154949759075, 272.08638214823225],
        [450.83710104864286, 187.9097859464342],
        [517.2972160194572, 127.74501562258531],
        [599.8663738522245, 89.36152603175972],
        [733.3956245987686, 60.809739671487016],
        [925.5582657616523, 48.520119761177206],
        [1143.6192172484853, 35.47192781067353],
        [1471.0108799174357, 16.359584415569987],
        [1625.3232397766044, 10.882328332299947],
        [1604.3005561460218, 2.2019430990032],
        [1673.6370067820044, 1.0756377485012032],
        [1629.9585489758097, 1.515332291451748],
        [112.33240329780254, 3147.920207134745],
        [162.97508346206433, 1695.3095631556348],
        [215.443469003188, 1018.3689244447086],
        [1321.9411484660275, 23.10129700083205],
        [1668.1005372000575, 6.22968952949504],
        [1668.1005372000575, 4.024788681558737],
        [0.5336699231206307, 9.642501682565362]])

    pbh_frac_15 = np.array([
        [0.5398951117104565, 9.562308366762421],
        [0.5120825479470089, 6.586554538799109],
        [0.6702376225238762, 15.78893349273697],
        [0.7573797422375818, 22.057662025759935],
        [0.8242610104805144, 33.367230242825116],
        [0.8889518019951514, 48.918190804784274],
        [0.9739710287674556, 74.17512222503494],
        [1.064973588604344, 116.1369653875233],
        [1.1782459390747921, 177.40019924635067],
        [1.29897792636765, 272.08638214823225],
        [1.443911620541974, 406.84987510911685],
        [1.591865722178999, 602.9020768269158],
        [1.7789568540562974, 903.6760620302173],
        [1.9831571632267209, 1385.242476123451],
        [2.2044282779703375, 2088.566917625967],
        [2.4503877568677166, 3123.027263930555],
        [2.7237902085594623, 4639.027913921878],
        [3.0276975876373142, 6666.491680890313],
        [3.4013021947731317, 9764.200495068228],
        [3.7466786441449123, 14113.141432247037],
        [4.292503602605768, 21098.343287717194],
        [5.030590067709108, 31308.553486746423],
        [6.085676209413647, 45648.33930064413],
        [7.59941928813399, 61228.97848919214],
        [9.590601717823164, 71281.72634778384],
        [12.103509205437977, 73460.13348841174],
        [15.274842955252293, 68960.01619057605],
        [19.277122307866904, 60042.56492628213],
        [24.32806972622142, 47548.80211379546],
        [30.702454814137784, 34145.30813798595],
        [38.33934295530013, 23853.946236068008],
        [46.873616523695226, 16808.25575002942],
        [56.904900751160135, 11618.128460811235],
        [67.9235949147397, 8073.58860971205],
        [105.41214621791568, 4827.191704176771],
        [138.12436127475348, 3171.2240087895807],
        [174.00834818894046, 2537.663104898311],
        [219.60161688436108, 1841.6247710558687],
        [271.33962117568933, 1265.3717408907983],
        [331.7393666736204, 886.3182794631936],
        [409.8969550378279, 604.3456453951694],
        [501.1393311323658, 441.9634174110721],
        [594.9514082763376, 290.4484389366252],
        [695.6149295516062, 193.777366031603],
        [841.5090815803576, 136.86867945924874],
        [1039.768097573499, 95.87599680323454],
        [1816.619081294492, 8.296117059869651],
        [2024.6557120098973, 1.0755953472602715],
        [2067.944844162867, 1.9843081725913105],
        [2046.185803111676, 1.515332291451748],
        [81.11308307896856, 6761.445093612861],
        [93.26033468832189, 5434.728656168448],
        [117.68119524349979, 4061.5859883770086],
        [1261.8568830660172, 64.0212442924707],
        [1450.8287784959386, 41.36192954523193],
        [1668.1005372000575, 26.722523665569174],
        [1788.6495290574296, 12.902442632349894],
        [1747.5284000076813, 17.264505764316308],
        [1917.9102616724829, 3.007882518043176],
        [1917.9102616724829, 5.0073130427342525]])

    pbh_frac_30 = np.array([
        [0.5246144896716607, 9.430538273574646],
        [0.5120825479470089, 6.836546207217794],
        [0.6260712659820531, 13.8338643084752],
        [0.7337228302884758, 19.465777397911708],
        [0.8070064188447906, 30.087076348215877],
        [0.8782700264679212, 45.231840316723236],
        [0.9558266469505197, 66.84382593752119],
        [1.0292866077582457, 98.63620144158435],
        [1.1083923264647386, 139.15361858078626],
        [1.206270154944395, 200.30136216451015],
        [1.3267513531210295, 295.0800845941071],
        [1.4627003279433577, 432.95049034082757],
        [1.6346107197178763, 652.8583076845283],
        [1.8222420349904138, 1001.3673497285432],
        [2.008962731338181, 1465.9968588253123],
        [2.2450750529169645, 2219.508807268856],
        [2.5027794592217734, 3392.562924750837],
        [2.7820275244625394, 4989.590055232102],
        [3.0924327424653644, 7182.146572245001],
        [3.4740253838705764, 10418.356039721595],
        [3.8210079723306745, 15331.18872441288],
        [4.384281555083343, 22330.643982125002],
        [5.138149035368004, 32699.256220117906],
        [6.281892410264672, 48052.42468918793],
        [7.927859466201154, 63576.833539561325],
        [10.005099038808138, 72362.73303844062],
        [12.626612164749453, 73129.17728845657],
        [15.93500815340165, 67623.80088001968],
        [20.11026247863026, 57825.22833603546],
        [25.379507375593775, 45040.922109919724],
        [31.692372587139186, 32510.318537649746],
        [39.15907584815945, 23038.82569093712],
        [48.38492975133628, 16311.299856373662],
        [60.42013340087651, 11622.50101894345],
        [76.25127831679845, 8653.250052647878],
        [96.23046355044137, 6402.747793815624],
        [121.44454912164737, 5353.734928654177],
        [153.26517162238665, 4577.987937254583],
        [193.42336072169195, 3724.9559522800337],
        [244.10370651624976, 2815.3834565557304],
        [301.6143878784792, 1971.3411750437253],
        [364.87320175639076, 1394.9600115586486],
        [436.75511151537575, 1000.1246807425534],
        [511.8541833434131, 693.371430183412],
        [681.0533387538941, 350.96161852795194],
        [887.2136756595839, 255.61085039338727],
        [1096.2406655782072, 189.89553286405177],
        [1271.2187357007037, 135.06777177865396],
        [1383.475133008952, 89.98012413525882],
        [1521.6554079575435, 58.06305308204471],
        [1653.5263384866169, 41.06362631273873],
        [1764.5366794121428, 29.349070216878378],
        [1920.356071453972, 19.40142669628394],
        [2112.159540574215, 10.042706421231207],
        [2061.704471572575, 2.8902442041169536],
        [2124.3813211412644, 1.0907533058165875],
        [2024.6557120098973, 14.886302228454076],
        [2074.20410512955, 1.7381437993391644],
        [2130.1089958530843, 5.404215854181385],
        [599.4842503189402, 491.6993166758915]])

    ogle_no_pbh = np.array([
        [32.187361799905375, 108.07710499308375],
        [33.31437580305736, 104.36615947525769],
        [34.52932052540658, 100.63616718830676],
        [35.86406092531123, 96.99611797777877],
        [37.73314874284492, 93.24319902428866],
        [38.99039346799818, 89.36682878943375],
        [40.276325537993024, 85.08553835170228],
        [41.56377928225118, 82.18196421400205],
        [42.80811879502087, 78.82408936087933],
        [44.089711436591166, 75.51559502030253],
        [45.40967249390036, 72.20710067972573],
        [46.769150643429995, 68.79984531405708],
        [49.00537824039311, 65.36789969211549],
        [49.61142590043141, 62.133476120357564],
        [51.096696455679414, 58.77560126723484],
        [52.40512689210841, 54.05623513963168],
        [54.73755824006955, 49.93648952151473],
        [56.37629532622611, 46.084809542932774],
        [58.06409304504316, 42.23312956435085],
        [59.80242017738694, 38.38144958576889],
        [61.59278947659441, 34.480389094641026],
        [63.43675898492453, 30.579328603513147],
        [65.335933389421, 26.727648624931206],
        [68.62841285597206, 22.52325069959268],
        [71.85092335791227, 20.110659943777605],
        [78.37074313258584, 17.399669805006482],
        [86.89461458522291, 13.888715362991391],
        [93.47933579477359, 12.111016911338183],
        [102.70442836486095, 11.491515935762067],
        [114.4361535149942, 10.212111747072242],
        [127.50797058900585, 8.636424483106907],
        [142.07295565554384, 6.9081065439996365],
        [158.30167036195053, 5.14836464236312],
        [176.38415927757785, 3.2090572405596163],
        [196.53217538970347, 1.3640217263438075],
        [218.98165981348012, 0.7983904008177802],
        [243.9955047542767, 0.6233140381549731],
        [271.8666320777853, 0.555976975592344],
        [301.4357816285554, 0.555976975592344],
        [337.52354284040376, 0.5829118006173815],
        [376.0781942740872, 0.44823767549215177],
        [419.03686782327503, 0.4617050880046776],
        [451.10746923213685, 0.555976975592344]
    ])

    ogle_pbh_frac_5 = np.array([
        [35.088899705424325, 102.13900691404298],
        [34.14346621431977, 105.58832716076927],
        [37.30275844431916, 95.76901224101259],
        [39.24187802804412, 92.08994699914336],
        [42.169163624557974, 83.1260034244388],
        [43.945438200887864, 78.87346987342525],
        [45.23141989471493, 75.48596671277497],
        [46.560582522125195, 72.45849237995952],
        [48.040326406185315, 69.32058526454136],
        [49.43435217666887, 65.71131871118484],
        [50.942336746491634, 60.82516385938813],
        [53.05942979555404, 56.68574743270206],
        [53.47407599970144, 52.14626745794476],
        [54.827336542078804, 49.14640132077997],
        [57.57677410821864, 45.104253650949474],
        [59.15907187011026, 39.802620736840524],
        [62.02690884981922, 35.280353397884966],
        [64.06360262832578, 30.739815269287405],
        [66.241570330077, 27.158493596894388],
        [88.62037908447712, 19.989453231164887],
        [102.05726630038451, 16.876488313410235],
        [118.02782876188063, 13.867552286185997],
        [169.58135265072397, 5.092250423560927],
        [202.41597026088928, 4.0260802663194255],
        [225.53754901757287, 4.432988515804965],
        [251.71243270543954, 4.524935671470843],
        [280.0057955114259, 3.539757036700493],
        [328.4293260334783, 0.9519355298957493],
        [368.75456958045777, 0.9453775888116098],
        [33.559972496957364, 108.46905537459283],
        [41.65990831887118, 87.62214983713355],
        [73.08862055414436, 23.7785016286645],
        [81.43256639732095, 21.824104234527695],
        [133.89382961641545, 10.09771986970685],
        [142.86622765964904, 7.491856677524439],
        [304.4865231438421, 2.2801302931596155]
    ])

    ogle_pbh_frac_15 = np.array([
        [35.31416001056788, 107.85830229344575],
        [37.61848194337349, 102.62549640801392],
        [41.415429319766254, 94.38792908785322],
        [41.591034360225144, 90.53385490260239],
        [42.92855293041637, 86.38938543602707],
        [43.74424845321439, 84.04854758823791],
        [45.52143691901941, 76.67603706513171],
        [46.769150643429995, 72.44336743975313],
        [47.838916679710906, 69.0237036375986],
        [49.39018258613239, 65.65744906113474],
        [50.70740935229674, 61.747576559350534],
        [52.11149887114896, 57.93777857103902],
        [54.58399446840016, 52.95575514575113],
        [56.09980452500799, 47.91188850713192],
        [57.77932464167205, 43.96144750345812],
        [59.509126356394475, 39.98631624351137],
        [61.290715003394375, 35.93711421474573],
        [63.12564098369852, 32.01136346734491],
        [65.42777519781218, 28.385422974687174],
        [67.37472560399814, 24.758600687162556],
        [70.5287354403316, 21.405526717204026],
        [77.98638319131265, 18.974908155221385],
        [81.6483058321546, 15.913316377374201],
        [88.55337406759341, 14.93945308232935],
        [98.82425513631766, 13.90291226034833],
        [110.29335815264757, 13.14636165771769],
        [122.59022700674616, 12.170017004250198],
        [133.64115416000195, 10.316858288836343],
        [147.77225471834163, 9.44831706600479],
        [164.65198916379623, 9.59261077149614],
        [183.45986252472042, 10.010100559384398],
        [203.0293082485028, 9.113999649897195],
        [227.76617452133735, 7.192846122835846],
        [260.3945992080538, 4.47223147058051],
        [292.433973943881, 3.584844366157114],
        [321.5414063826896, 2.8615609445380557],
        [358.3558619946555, 1.7651582276096889],
        [44.451592453624606, 79.80456026058633],
        [39.89688299910101, 98.0456026058632]
    ])

    ogle_pbh_frac_30 = np.array([
        [39.15046630608607, 108.38696770930942],
        [40.49757787180431, 100.84779795636072],
        [42.38925385374832, 93.96744654162886],
        [42.26439540552176, 90.74454508946499],
        [43.12498147009096, 87.70023649100887],
        [44.52537927012583, 84.71683052469274],
        [45.66152936078682, 80.22305691720265],
        [47.46407696452125, 76.76245296208707],
        [48.01170612402436, 72.09187948378525],
        [49.61142590043141, 68.4788719825086],
        [50.818330610126495, 64.58604157680503],
        [54.98275512267977, 52.270841023685605],
        [53.671616796775474, 56.20781461484688],
        [57.43317031558931, 46.97365876875938],
        [58.35026494428518, 42.44299674267101],
        [59.290100343108236, 39.10981214582125],
        [62.11409920866413, 34.71318293950037],
        [64.85587478008964, 30.542293219103712],
        [67.65384847507225, 25.797274877190986],
        [72.37089759676792, 20.449739463259604],
        [81.11483025277064, 15.558674514544393],
        [89.16667769975672, 13.953527285707906],
        [98.74331094508055, 13.902182775503917],
        [110.02256543162014, 13.103490394552807],
        [151.55625112407634, 14.019926439184829],
        [169.58135265072397, 15.154652139168661],
        [190.55155406532037, 15.423038431382551],
        [210.53594738306703, 15.65294640213206],
        [234.58505517953398, 14.791032001330521],
        [260.7395009865226, 12.654202549343324],
        [273.8789697073585, 10.481459997322744],
        [297.02243005471195, 8.012434370026625],
        [323.9745222824733, 3.4611971303774425],
        [362.1666009315702, 1.8625030367032025],
        [402.5454167513439, 0.7653444701546448],
        [433.7090991421887, 0.6670831288206642],
        [41.65990831887118, 97.39413680781759],
        [39.89688299910101, 103.90879478827361],
        [51.71482072263622, 60.26058631921824],
        [125.48492322523279, 13.355048859934868],
        [139.81053774070807, 14.00651465798046]
    ])

    wfirst_no_pbh = np.array([
        [41.172939313274256, 2973.303979125897],
        [41.579785370696655, 2869.8923679060667],
        [42.40557783000927, 2777.3091976516635],
        [43.46091976919927, 2681.2744618395304],
        [44.32407236847874, 2596.0004892367906],
        [45.20436755041867, 2508.696183953033],
        [46.10214577409944, 2419.3615459882585],
        [47.017754260265825, 2331.0420743639925],
        [47.95154712561584, 2241.7074363992174],
        [48.903885519758155, 2152.3727984344423],
        [49.87513776488795, 2062.0229941291586],
        [50.865679498238336, 1973.7035225048924],
        [51.92692791417793, 1875.0293542074364],
        [53.616917026747615, 1766.3195415152363],
        [55.08265386498253, 1663.0626223091976],
        [56.95529661566732, 1569.6673189823873],
        [58.66042851811337, 1474.918460534899],
        [60.41660878616387, 1380.16960208741],
        [62.22536570958145, 1284.0671885192432],
        [64.08827333218161, 1190.671885192433],
        [66.33227151793577, 1083.4026418786689],
        [69.67495953986675, 989.6689497716893],
        [73.90927662299217, 903.0414220482712],
        [78.40092347392574, 813.7067840834961],
        [83.16553864974802, 725.0489236790604],
        [89.09144487170373, 629.6232876712324],
        [97.33506922360228, 541.9129158512715],
        [107.39227755962946, 448.9236790606651],
        [119.07263086922576, 363.6497064579253],
        [132.67406364579892, 295.72584949297243],
        [147.82916137648613, 229.64774951076288],
        [164.71539615774117, 179.07400818359656],
        [183.53051237505824, 133.66838640811193],
        [204.49484236673388, 98.2298523394411],
        [227.8538866013558, 78.2956769258135],
        [253.88118858389979, 59.099804305283214],
        [282.8815381566988, 43.22629425369132],
        [315.19454070719877, 26.983632805550315],
        [351.19859407929823, 15.909090909090537],
        [391.31531975946575, 14.4324853228959],
        [436.0145002285461, 11.110122753957512],
        [485.8195802975582, 8.526062978117352],
        [541.3137968502904, 2.9887920298874633],
        [603.1470087743398, 4.8345490126307595],
        [672.0433070617711, 6.3111545988253965],
        [748.8094941966284, 6.3111545988253965],
        [834.3445321262175, 4.096246219533441],
        [929.6500694556132, 2.250489236790145],
        [991.0074472138023, 4.280821917807771]
    ])

    wfirst_pbh_frac_5 = np.array([
        [41.47769850518763, 2948.094015003262],
        [42.584656106314235, 2840.075482247694],
        [43.41820611606374, 2735.0782778864973],
        [43.67511917025615, 2666.0469667318985],
        [44.68875934137977, 2502.868377183446],
        [48.37778253136639, 2247.7984344422703],
        [48.903885519758155, 2161.5092954990214],
        [50.56094462782143, 1981.1480756686235],
        [54.938410569957, 1767.4668406175256],
        [56.90440706175131, 1673.7557077625572],
        [58.77590236615974, 1576.164383561644],
        [63.32761326818613, 1343.4495853135775],
        [64.93403624372608, 1242.5581648184389],
        [66.09973787264896, 1122.4140341067932],
        [77.57928642179837, 877.6139222812408],
        [83.16553864974802, 787.9892367906064],
        [95.90997669269117, 621.6865326454363],
        [106.86558497198648, 524.3331060111882],
        [118.9349659912875, 433.7976058003105],
        [127.73637872672761, 398.21370328953435],
        [139.35991946259853, 335.689417942353],
        [155.27872937283718, 269.99072356215083],
        [189.02506249275345, 183.5565608559732],
        [210.6170241535859, 147.907083132131],
        [234.67539319032244, 123.42004049440402],
        [261.48190247371645, 102.23778178768407],
        [291.3504666670517, 81.98719089130009],
        [324.63085828909743, 66.48283223625685],
        [361.71280368652344, 54.3008361501511],
        [403.0305468811913, 48.91122576054022],
        [449.06793473676447, 50.58471209156096],
        [619.67888587707, 28.182886548835995],
        [692.1629895283396, 27.03636871934259],
        [771.2274084781586, 25.515816538320905],
        [859.3232007294214, 12.530476698773327],
        [45.9168229507027, 2428.571428571429],
        [46.92037801362988, 2339.2857142857147],
        [50.06457300068296, 2071.4285714285716],
        [53.419464545077034, 1857.142857142857],
        [60.81875963262253, 1464.2857142857142],
        [70.75632339281279, 1035.7142857142853],
        [73.8830135073809, 946.4285714285711],
        [89.75355166572388, 678.5714285714284],
        [102.18559342401524, 571.4285714285716],
        [171.6887283873047, 232.14285714285688],
        [551.8029749320337, 17.857142857142662],
        [495.26276819862426, 35.714285714285325]
    ])

    wfirst_pbh_frac_15 = np.array([
        [42.03655332433797, 2933.238747553816],
        [43.15337389943633, 2834.4292237442924],
        [43.532202590466724, 2742.5228310502284],
        [44.60513866801649, 2666.162985742242],
        [45.49101594781132, 2585.413754542913],
        [46.39448713221641, 2478.482900009319],
        [47.59922104968452, 2393.9823874755384],
        [48.903885519758155, 2303.125],
        [49.980337888942806, 2213.5728263908304],
        [51.16208696378681, 2090.5399395125423],
        [52.0583891052394, 1980.9547106513837],
        [55.26575488444092, 1879.5468444227006],
        [57.94383924870602, 1749.1390597334826],
        [59.49024552500401, 1647.931119120838],
        [63.81316475927509, 1431.054814905414],
        [66.72477107035022, 1330.088062622309],
        [71.76089365613969, 1228.5714285714284],
        [78.01641551677628, 1140.1391606871057],
        [85.23526827787006, 1045.841487279843],
        [94.04225693555996, 964.2590286425898],
        [102.85629316086269, 893.7921287236354],
        [113.36006699297938, 823.6123465575515],
        [126.30896481691528, 774.1460594200321],
        [140.73698980884365, 731.3244974203876],
        [156.8130997602953, 681.8582102828677],
        [174.72555217950995, 622.0556840419849],
        [194.6841088601744, 560.0382494218106],
        [216.922492273714, 488.05372709482253],
        [241.70112255045743, 411.639388009251],
        [269.3101671007784, 334.117594734033],
        [301.3666001427076, 256.55751298807127],
        [330.89735777449346, 194.8284392397245],
        [493.03820216700944, 72.06432444553138],
        [596.7562043855104, 49.35635593658981],
        [665.4675595571236, 31.37184678769745],
        [741.4826119686826, 18.49315068493115],
        [826.1807145306933, 17.865593310798886],
        [920.553715009132, 18.308574986656822],
        [991.0074472138023, 7.326320939333982],
        [62.148010443720636, 1535.7142857142856],
        [540.000753963769, 71.4285714285711],
        [365.91505792521735, 142.85714285714266],
        [416.5990831887118, 107.14285714285688]
    ])

    wfirst_pbh_frac_30 = np.array([
        [42.03655332433797, 2940.367471189389],
        [43.67511917025615, 2852.0254403131116],
        [44.70707225006043, 2746.245107632094],
        [45.65104974078217, 2649.127527723418],
        [47.36577636004622, 2478.9663125524185],
        [46.215614547077024, 2580.7729941291586],
        [48.903885519758155, 2363.527397260274],
        [49.87513776488795, 2275.5463144161777],
        [50.865679498238336, 2188.9187866927596],
        [52.13156685520531, 2102.1945764607217],
        [53.586799237540546, 2004.9706457925636],
        [55.64684081279033, 1931.306484611279],
        [58.372735458700454, 1840.378343118069],
        [69.49075175041777, 1450.2815262037373],
        [74.8846457777016, 1372.3866601435095],
        [83.16553864974802, 1269.9902152641878],
        [92.21090854678323, 1180.2125956235545],
        [102.49172208178986, 1096.261415525114],
        [116.75384910243783, 1014.8327699697561],
        [130.0904119916637, 1016.6785269524994],
        [144.95038426795128, 1024.79985767657],
        [161.5077819937503, 987.1464152286067],
        [179.95649874457146, 921.4374666429458],
        [198.55061917549776, 851.3807349423782],
        [215.85862184122252, 753.4735812133072],
        [232.379162999562, 665.8792284036899],
        [248.93718871826027, 582.3455409561084],
        [267.9893675795077, 494.60616438356146],
        [288.4996874329866, 405.99664523343563],
        [485.8195802975582, 116.6874221668736],
        [541.3137968502904, 99.46035699460299],
        [603.1470087743398, 82.35634228784875],
        [672.0433070617711, 62.05301547767249],
        [834.3445321262175, 39.16562889165607],
        [929.6500694556132, 33.38225701239389],
        [995.8916789043277, 27.21606146263639],
        [60.81875963262253, 1732.142857142857],
        [63.50631327313489, 1642.857142857143],
        [66.312628700541, 1517.8571428571427],
        [314.52312509741756, 285.7142857142853],
        [350.4297259108146, 214.28571428571377],
        [398.9688299910101, 178.57142857142844],
        [435.0084093476314, 142.85714285714266],
        [746.860406386791, 53.57142857142844]
    ])

    data = [no_pbh, pbh_frac_5, pbh_frac_15, pbh_frac_30,
            ogle_no_pbh, ogle_pbh_frac_5, ogle_pbh_frac_15, ogle_pbh_frac_30,
            wfirst_no_pbh, wfirst_pbh_frac_5, wfirst_pbh_frac_15, wfirst_pbh_frac_30]
    for i, d in enumerate(data):
        data[i] = d[np.argsort(d[:, 0])]
    return data


def plot_pbh_te_shift():
    data = return_pbh_te_shift_data()
    no_pbh, pbh_frac_5, pbh_frac_15, pbh_frac_30,\
    ogle_no_pbh, ogle_pbh_frac_5, ogle_pbh_frac_15, ogle_pbh_frac_30,\
    wfirst_no_pbh, wfirst_pbh_frac_5, wfirst_pbh_frac_15, wfirst_pbh_frac_30 = data

    color_no_pbh = '#2B303A'
    color_pbh_frac_5 = '#92d2e5'
    color_pbh_frac_15 = '#D64933'
    color_pbh_frac_30 = '#C8AD55'

    fig, ax = plt.subplots(1, 3, figsize=(16, 6))
    for a in ax:
        a.clear()

    ax[0].set_title('PopSyCLE - No Cuts')
    ax[0].plot(*pbh_frac_5.T, color=color_pbh_frac_5, label=r'$f_{\rm PBH} = 5$%', linewidth=4)
    ax[0].plot(*pbh_frac_15.T, color=color_pbh_frac_15, label=r'$f_{\rm PBH} = 15$%', linewidth=4)
    ax[0].plot(*pbh_frac_30.T, color=color_pbh_frac_30, label=r'$f_{\rm PBH} = 30$%', linewidth=4)
    ax[0].plot(*no_pbh.T, color=color_no_pbh, label='No PBHs', linewidth=4)
    ax[0].set_xlim(0.5, 10000)
    ax[0].set_ylim(1e0, 1e5)
    ax[0].set_yscale('log')

    ax[1].set_title('PopSyCLE - OGLE Cuts')
    ax[1].plot(*ogle_pbh_frac_5.T, color=color_pbh_frac_5, label=r'$f_{\rm PBH} = 5$%', linewidth=4)
    ax[1].plot(*ogle_pbh_frac_15.T, color=color_pbh_frac_15, label=r'$f_{\rm PBH} = 15$%', linewidth=4)
    ax[1].plot(*ogle_pbh_frac_30.T, color=color_pbh_frac_30, label=r'$f_{\rm PBH} = 30$%', linewidth=4)
    ax[1].plot(*ogle_no_pbh.T, color=color_no_pbh, label='No PBHs', linewidth=4)
    ax[1].set_xlim(10, 1000)
    ax[1].set_ylim(0, 108)

    ax[2].set_title('PopSyCLE - WFIRST Cuts')
    ax[2].plot(*wfirst_pbh_frac_5.T, color=color_pbh_frac_5, label=r'$f_{\rm PBH} = 5$%', linewidth=4)
    ax[2].plot(*wfirst_pbh_frac_15.T, color=color_pbh_frac_15, label=r'$f_{\rm PBH} = 15$%', linewidth=4)
    ax[2].plot(*wfirst_pbh_frac_30.T, color=color_pbh_frac_30, label=r'$f_{\rm PBH} = 30$%', linewidth=4)
    ax[2].plot(*wfirst_no_pbh.T, color=color_no_pbh, label='No PBHs', linewidth=4)
    ax[2].set_xlim(10, 1000)
    ax[2].set_ylim(0, 3000)

    for a in ax:
        a.grid(True)
        a.set_xscale('log')
        a.set_xlabel(r'$t_{\rm E}$ (days)')
        a.set_ylabel('Number of Events')
        handles, labels = a.get_legend_handles_labels()
        handles = handles[-1:] + handles[:-1]
        labels = labels[-1:] + labels[:-1]
        a.legend(handles, labels, fontsize=12)
    fig.tight_layout()

    fname = '%s/thesis_chapter1_pbh_te_shift.png' % return_figures_dir()
    fig.savefig(fname, dpi=100, bbox_inches='tight', pad_inches=0.05)
    print('-- %s saved' % fname)
    plt.close(fig)


def return_ogle_limits_data():
    macho = np.array([
        [-0.7761989342806395, 0.2991803278688524],
        [-0.7835702804007569, 0.2901867016617012],
        [-0.7925011496774577, 0.28304369336418805],
        [-0.8028298941452938, 0.2753949228569327],
        [-0.8082660754441555, 0.2693950348074019],
        [-0.8196820561717644, 0.2611048294458938],
        [-0.827836328120056, 0.25322344340173664],
        [-0.827836328120056, 0.2482061154160663],
        [-0.8376214544580063, 0.2448152379190841],
        [-0.8441448720166402, 0.23792756155653333],
        [-0.8536581892896473, 0.22901222267921806],
        [-0.8571917071339072, 0.22219913427288285],
        [-0.8648023609523126, 0.21403811183365132],
        [-0.873500251030491, 0.20716158508884647],
        [-0.8789364323293523, 0.20008157782017832],
        [-0.882198141108669, 0.19288775153702042],
        [-0.8876343224075303, 0.18514109004062665],
        [-0.8930705037063915, 0.1778882636968965],
        [-0.8976006547887763, 0.1704793427047233],
        [-0.9030368360876375, 0.16273732688239032],
        [-0.9084730173864988, 0.1547990313309883],
        [-0.9093790476029757, 0.14734388588191008],
        [-0.9132620342450193, 0.13901950163266893],
        [-0.91390919868536, 0.13127449930558258],
        [-0.914815228901837, 0.12394594847466134],
        [-0.9159024651616092, 0.11542253027530078],
        [-0.9169897014213815, 0.10762974387216048],
        [-0.9120971382524061, 0.10118214557671257],
        [-0.9109322422597934, 0.09393039058230668],
        [-0.9053019116288294, 0.08478756181612865],
        [-0.8957885943558224, 0.07949149338680997],
        [-0.8889933677322457, 0.07315711680490117],
        [-0.8827708703374779, 0.0663934426229508],
        [-0.8721136767317939, 0.060655737704918],
        [-0.8495810533155015, 0.055059893501031854],
        [-0.8332725094189177, 0.04990551813056776],
        [-0.786856127886324, 0.04385245901639345],
        [-0.7082403395451076, 0.04145039133990108],
        [-0.6422295666303635, 0.042973508764122426],
        [-0.5784515110347943, 0.04594508099373079],
        [-0.5168867578251897, 0.04933177738405825],
        [-0.4558462078122618, 0.053456140448469414],
        [-0.41740464005602895, 0.05556162629959893],
        [-0.36032473641798557, 0.0590110392897473],
        [-0.3126110124333925, 0.06311475409836065],
        [-0.2433392539964485, 0.07049180327868851],
        [-0.20071047957371224, 0.07622950819672131],
        [-0.16873889875666137, 0.08114754098360655],
        [-0.1367673179396096, 0.08606557377049179],
        [-0.11841466861865779, 0.08956796042469786],
        [-0.08851567147492023, 0.09538666718585725],
        [-0.07383798196799507, 0.10121791726698079],
        [-0.04706478907110334, 0.10759172400748065],
        [-0.03019538188277071, 0.11147540983606555],
        [-0.024866785079929343, 0.11762295081967211],
        [-0.005613906667285562, 0.12373979668821306],
        [0.00933559190458233, 0.13024228860019726],
        [0.023832075368212635, 0.13721764376479922],
        [0.03651649839888904, 0.14501640317744635],
        [0.0446707703471807, 0.1505424324727749],
        [0.04738886099661155, 0.1558245638799112],
        [0.060979314243764904, 0.16230179493918978],
        [0.06587187741274025, 0.16953799640645947],
        [0.07301657283410012, 0.17818253396526243],
        [0.07728785814034911, 0.18494696723165727],
        [0.08326765756909627, 0.1914643170047895],
        [0.08544213008864077, 0.19656944823020908],
        [0.08932511673068433, 0.20200886888768976],
        [0.08816022073807162, 0.21036710019080251],
        [0.092237356712217, 0.21395463902579448],
        [0.09087831138750246, 0.22068049660579153],
        [0.09196554764727427, 0.22895072556883814],
        [0.09359640203693242, 0.23628996145009926],
        [0.09359640203693242, 0.24299599195687255],
        [0.09631449268636327, 0.2460458769777916],
        [0.09631449268636327, 0.2515432579497452],
        [0.09087831138750246, 0.2587285671637916],
        [0.09087831138750246, 0.26593350988130926],
        [0.08816022073807162, 0.2743031894526433],
        [0.08652936634841346, 0.28200140320526007],
        [0.08544213008864077, 0.2895990712978466],
        [0.08544213008864077, 0.2962330938566774]
    ])

    ogle = np.array([
        [-2.580098766786346, 0.29280458639980267],
        [-2.5746625854874847, 0.2874388328595719],
        [-2.5583540415909005, 0.2785075244776726],
        [-2.5755686157039617, 0.2845817433121763],
        [-2.551105799859086, 0.2621431375984839],
        [-2.5456696185602246, 0.2563244308373246],
        [-2.5402334372613633, 0.2506450942979894],
        [-2.5347972559625016, 0.2448612300922861],
        [-2.5293610746636404, 0.2391470509974949],
        [-2.523924893364779, 0.23336318679179158],
        [-2.518488712065918, 0.22764900769700036],
        [-2.5130525307670566, 0.22186514349129705],
        [-2.5076163494681953, 0.21611612184104978],
        [-2.502180168169334, 0.21036710019080251],
        [-2.496743986870473, 0.2046529210960113],
        [-2.4913078055716116, 0.19918263988941237],
        [-2.4757758590034364, 0.19346348328669888],
        [-2.4586907177784436, 0.18824207747621455],
        [-2.44238217388186, 0.18284148138052775],
        [-2.426073629985276, 0.17754541295120904],
        [-2.409765086088692, 0.1722145019664343],
        [-2.393456542192108, 0.1669695359517845],
        [-2.3771479982955244, 0.16162236510779693],
        [-2.3608394543989406, 0.15632629667847822],
        [-2.3445309105023564, 0.15103022824915954],
        [-2.3282223666057726, 0.14566447470892877],
        [-2.311913822709189, 0.14033356372415404],
        [-2.295605278812605, 0.13510718040574743],
        [-2.279296734916021, 0.1298459545318848],
        [-2.262988191019437, 0.12500283932349465],
        [-2.2466796471228534, 0.12009003900419243],
        [-2.2303711032262696, 0.1151423961294342],
        [-2.2140625593296854, 0.11005538303285176],
        [-2.1977540154331017, 0.1047593146035331],
        [-2.181445471536518, 0.09974198661786277],
        [-2.165136927639934, 0.09496855652038472],
        [-2.14882838374335, 0.09002091364562645],
        [-2.132519839846766, 0.08503842821541216],
        [-2.1162112959501824, 0.08016047045156602],
        [-2.097184661404168, 0.07469018924496709],
        [-2.0618494829615694, 0.06991178163956677],
        [-2.0237962138695402, 0.065432024509504],
        [-1.9857429447775115, 0.060982132426974894],
        [-1.9476896756854822, 0.0565023752969121],
        [-1.9069183159440226, 0.05179863031034615],
        [-1.8552745936048405, 0.04808314689671528],
        [-1.7954765993173663, 0.04500433199641757],
        [-1.735678605029892, 0.04192551709611986],
        [-1.6758806107424178, 0.039587898375523456],
        [-1.6160826164549436, 0.03873267201432967],
        [-1.5562846221674693, 0.037934460743882126],
        [-1.496486627879995, 0.03730729474567335],
        [-1.435329588267805, 0.03692085913061538],
        [-1.3758034030452744, 0.03716475701880767],
        [-1.3170926450175724, 0.037117244443185815],
        [-1.2572946507300982, 0.03752992510001585],
        [-1.1997617319838159, 0.037485308529003336],
        [-1.1376986621551497, 0.03747834001791206],
        [-1.0779006678676755, 0.03787744565313589],
        [-1.0181026735802012, 0.03935983801253845],
        [-0.9583046792927274, 0.040823225341692304],
        [-0.8985066850052532, 0.042305617701094866],
        [-0.8366178517566785, 0.044220948826493744],
        [-0.7738369272180341, 0.04461641821234036],
        [-0.7191127021428301, 0.04764603120099403],
        [-0.6593147078553558, 0.050059670042585436],
        [-0.5995167135678816, 0.052948434640395614],
        [-0.5397187192804074, 0.055742174086962026],
        [-0.46361218109634983, 0.05942914995521981],
        [-0.37997862265233007, 0.0626293046640288],
        [-0.30052674213051134, 0.0668405687513686],
        [-0.2407287478430371, 0.07099846211914715],
        [-0.1820956495481756, 0.0749451561626818],
        [-0.13985738374194412, 0.07810088828460873],
        [-0.08307949017605942, 0.08147498504377132],
        [-0.02599958653801604, 0.08577012187998909],
        [0.031080317100028232, 0.09021729895819688],
        [0.08816022073807162, 0.09480131225419572],
        [0.1398039430772533, 0.0995445454702785],
        [0.18601148411757507, 0.10424538691055643],
        [0.2295009345084651, 0.10868781273120204],
        [0.27570847554878597, 0.1133189690605679],
        [0.32191601658910685, 0.11814756653751801],
        [0.3654054669799969, 0.12274678385771581],
        [0.4088949173708878, 0.12734600117791361],
        [0.4523843677617778, 0.13197135041470345],
        [0.49979994909073433, 0.13680285143794157],
        [0.5339270872446971, 0.1411279739885518],
        [0.5560601111043466, 0.14547035189995938],
        [0.5929837840823264, 0.15048224987698722],
        [0.6189644947054562, 0.15562446806143507],
        [0.6527817783698007, 0.16013680524335286],
        [0.6807039823139522, 0.16531567598613758],
        [0.7106029794576889, 0.1699985154394299],
        [0.7371798658076782, 0.1750599773286779],
        [0.7601326312917589, 0.179891478351916],
        [0.7867095176417473, 0.18505049939644092],
        [0.8138904241360541, 0.19044412698103655],
        [0.8404673104860425, 0.19552417156652774],
        [0.8634200759701232, 0.20037890096006988],
        [0.8872788716706816, 0.20511458495580387],
        [0.9110621648531998, 0.21055002360694675],
        [0.9280502314121408, 0.21603482254498568],
        [0.9423202073216519, 0.22147316474241655],
        [0.9606673192053083, 0.22709152680970363],
        [0.9769758631018925, 0.23317735982935933],
        [0.9912458390114036, 0.2386157020267902],
        [1.007780890462107, 0.2439320952801249],
        [1.0259014947916443, 0.2500458023441454],
        [1.0422100386882285, 0.25628958828186854],
        [1.0591981052471695, 0.2618731077936996],
        [1.0741476038190383, 0.26776118857152587],
        [1.089097102390907, 0.2729530404287216],
        [1.105114422289338, 0.2781308930448858],
        [1.1155984862228552, 0.2830835134275664],
        [1.1276357448131913, 0.287866898540889],
        [1.1385081074109138, 0.29300368671669436],
        [-2.587921847246892, 0.29959016393442617],
        [1.1580817051509769, 0.29959016393442617]
    ])

    eros = np.array([
        [-3.9808214814596052, 0.08908514215623559],
        [-3.9668912668812735, 0.08613045197433034],
        [-3.912416200115601, 0.08527797078417251],
        [-3.8500133689557554, 0.08229457697324871],
        [-3.7994507053975966, 0.0803156781985975],
        [-3.7416295043097083, 0.07899482859630924],
        [-3.681831510022234, 0.07697079287481726],
        [-3.62203351573476, 0.07429108360974329],
        [-3.5622355214472856, 0.07185843973790315],
        [-3.5024375271598114, 0.06969186628954549],
        [-3.4426395328723376, 0.06687912181273034],
        [-3.3828415385848634, 0.06501391384403146],
        [-3.323043544297389, 0.062494389833911285],
        [-3.2683419699775973, 0.05898752056481446],
        [-3.2034475557224407, 0.05751386524015123],
        [-3.1436495614349664, 0.0551086730786704],
        [-3.083851567147492, 0.05262534912616684],
        [-3.025308076236678, 0.04923689842535489],
        [-2.9642555785725437, 0.04707859529785269],
        [-2.90445758428507, 0.04452920624019879],
        [-2.8446595899975957, 0.041019610654262684],
        [-2.784861595710121, 0.03858063177233967],
        [-2.725063601422647, 0.03457057038985312],
        [-1.4047110965403964, 0.03400959282542243],
        [-1.1177659973926586, 0.044934646885505525],
        [-0.9963579483847562, 0.049869619740097904],
        [-0.936559954097282, 0.05215022336994807],
        [-0.8740438691603774, 0.05413258377510882],
        [-0.8363788987325527, 0.05599068748250047],
        [-0.7826480710732717, 0.05771489622678244],
        [-0.730973461340346, 0.060170346134921115],
        [-0.6743289228712595, 0.06356048153072219],
        [-0.3753389514338883, 0.07965774215141452],
        [-0.257676842480663, 0.08856162544064389],
        [-0.2013811498703264, 0.0921015119571445],
        [-0.15231927303524007, 0.0976202583724605],
        [-0.10037643067243618, 0.10155485533659084],
        [-0.04570574374638792, 0.10630682181657367],
        [0.06913358619205656, 0.11905009538471359],
        [0.10718685528408578, 0.12484355906998135],
        [0.145240124376115, 0.13013630916068517],
        [0.20775620931302008, 0.14001998072504965],
        [0.2403732971061876, 0.1448553531433384],
        [0.2729903848993551, 0.1497620698418467],
        [0.30560747269252264, 0.15518664093402593],
        [0.34249584579193915, 0.16131077311186143],
        [0.37084164827885857, 0.1660357554655625],
        [0.4034587360720261, 0.17179639130096178],
        [0.43335773321576365, 0.17706259468274674],
        [0.4895316066373301, 0.18756900779383354],
        [0.5164536473555001, 0.19424850739330035],
        [0.5389749698793542, 0.19906654544272961],
        [0.5556718124401421, 0.20510587431693986],
        [0.5746984469861571, 0.21066575066614002],
        [0.5987729641668285, 0.2155621963165547],
        [0.6116644798184137, 0.22093879608357234],
        [0.6317783506242005, 0.22662463656659265],
        [0.6508049851702147, 0.23211549147260369],
        [0.6680195592832758, 0.23725684236400446],
        [0.69308639527247, 0.24362444842009823],
        [0.7096969492412128, 0.2489796201471905],
        [0.7223813722718884, 0.2538610621665823],
        [0.7405019766014265, 0.2597064815535912],
        [0.761703083666986, 0.26528593610061907],
        [0.776613752372433, 0.2705118927754895],
        [0.7968052829110617, 0.2769661561910695],
        [0.8138904241360541, 0.28236525903437965],
        [0.8350311291871808, 0.2878978697012944],
        [0.8519436932280833, 0.2996217812501738],
        [0.8546617838775132, 0.2947333707196908],
        [-2.651865008880995, 0.032377049180327855],
        [-2.5346358792184724, 0.02868852459016391],
        [-2.3960923623445827, 0.025819672131147553],
        [-2.252220248667851, 0.022540983606557374],
        [-2.1349911190053286, 0.021311475409836078],
        [-2.0230905861456487, 0.020491803278688547],
        [-1.9325044404973357, 0.020901639344262313],
        [-1.8525754884547068, 0.02213114754098361],
        [-1.7513321492007106, 0.02377049180327867],
        [-1.6447602131438726, 0.02622950819672132],
        [-1.5595026642984013, 0.028278688524590145],
        [-1.4689165186500892, 0.03114754098360656],
        [-1.2717584369449382, 0.03975409836065574],
        [-1.1865008880994674, 0.042213114754098335],
        [-1.063943161634103, 0.047131147540983576],
        [-0.5683836589698048, 0.0663934426229508],
        [-0.4777975133214927, 0.07131147540983604],
        [-0.42451154529307367, 0.07622950819672131],
        [-0.3126110124333925, 0.0836065573770492],
        [0.007104795737122416, 0.11147540983606555],
        [0.028419182948489663, 0.11475409836065573],
        [0.1722912966252217, 0.13483606557377045],
        [0.4547069271758435, 0.18155737704918032]
    ])

    data = [macho, eros, ogle]
    for i, d in enumerate(data):
        if i == 0:
            continue
        data[i] = d[np.argsort(d[:, 0])]
    return data


def plot_ogle_limits_data():
    macho, eros, ogle = return_ogle_limits_data()

    color_macho = '#6FECAD'
    color_eros = '#073B3A'
    color_ogle = '#BDA0BC'

    fig, ax = plt.subplots(figsize=(8, 5))
    ax.clear()
    ax.plot(*macho.T, color=color_macho, label='MACHO', linewidth=4)
    ax.plot(*eros.T, color=color_eros, label='EROS', linewidth=4)
    ax.plot(*ogle.T, color=color_ogle, label='OGLE III', linewidth=4)
    ax.set_xlabel(r'logM = 2log(<$t_{\rm E}$>/70d)')
    ax.set_ylabel('MACHO halo mass fraction')
    ax.set_xlim(-4, 2)
    ax.set_ylim(0, .3)
    ax.legend()
    fig.tight_layout()

    fname = '%s/thesis_chapter1_macho_limits.png' % return_figures_dir()
    fig.savefig(fname, dpi=100, bbox_inches='tight', pad_inches=0.05)
    print('-- %s saved' % fname)
    plt.close(fig)


def generate_all_figures():
    plot_example_ulens()
    plot_example_fringez()
    plot_pbh_te_shift()


if __name__ == '__main__':
    generate_all_figures()